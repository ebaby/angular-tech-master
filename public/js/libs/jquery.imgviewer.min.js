(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){module.exports=a}else{a(jQuery)}}}(function(c){var d=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],k=("onwheel" in document||document.documentMode>=9)?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],h=Array.prototype.slice,j,b;if(c.event.fixHooks){for(var e=d.length;e;){c.event.fixHooks[d[--e]]=c.event.mouseHooks}}var f=c.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener){for(var m=k.length;m;){this.addEventListener(k[--m],l,false)}}else{this.onmousewheel=l}c.data(this,"mousewheel-line-height",f.getLineHeight(this));c.data(this,"mousewheel-page-height",f.getPageHeight(this))},teardown:function(){if(this.removeEventListener){for(var m=k.length;m;){this.removeEventListener(k[--m],l,false)}}else{this.onmousewheel=null}c.removeData(this,"mousewheel-line-height");c.removeData(this,"mousewheel-page-height")},getLineHeight:function(m){var i=c(m),n=i["offsetParent" in c.fn?"offsetParent":"parent"]();if(!n.length){n=c("body")}return parseInt(n.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(i){return c(i).height()},settings:{adjustOldDeltas:true,normalizeOffset:true}};c.fn.extend({mousewheel:function(i){return i?this.bind("mousewheel",i):this.trigger("mousewheel")},unmousewheel:function(i){return this.unbind("mousewheel",i)}});function l(i){var o=i||window.event,u=h.call(arguments,1),w=0,q=0,p=0,t=0,s=0,r=0;i=c.event.fix(o);i.type="mousewheel";if("detail" in o){p=o.detail*-1}if("wheelDelta" in o){p=o.wheelDelta}if("wheelDeltaY" in o){p=o.wheelDeltaY}if("wheelDeltaX" in o){q=o.wheelDeltaX*-1}if("axis" in o&&o.axis===o.HORIZONTAL_AXIS){q=p*-1;p=0}w=p===0?q:p;if("deltaY" in o){p=o.deltaY*-1;w=p}if("deltaX" in o){q=o.deltaX;if(p===0){w=q*-1}}if(p===0&&q===0){return}if(o.deltaMode===1){var v=c.data(this,"mousewheel-line-height");w*=v;p*=v;q*=v}else{if(o.deltaMode===2){var n=c.data(this,"mousewheel-page-height");w*=n;p*=n;q*=n}}t=Math.max(Math.abs(p),Math.abs(q));if(!b||t<b){b=t;if(a(o,t)){b/=40}}if(a(o,t)){w/=40;q/=40;p/=40}w=Math[w>=1?"floor":"ceil"](w/b);q=Math[q>=1?"floor":"ceil"](q/b);p=Math[p>=1?"floor":"ceil"](p/b);if(f.settings.normalizeOffset&&this.getBoundingClientRect){var m=this.getBoundingClientRect();s=i.clientX-m.left;r=i.clientY-m.top}i.deltaX=q;i.deltaY=p;i.deltaFactor=b;i.offsetX=s;i.offsetY=r;i.deltaMode=0;u.unshift(i,w,q,p);if(j){clearTimeout(j)}j=setTimeout(g,200);return(c.event.dispatch||c.event.handle).apply(this,u)}function g(){b=null}function a(m,i){return f.settings.adjustOldDeltas&&m.type==="mousewheel"&&i%120===0}}));(function(b){b.fn.iviewer=function(d){return this.each(function(){b(this).data("viewer",new a(this,d))})};var c={zoom:"fit",zoom_base:100,zoom_max:600,zoom_min:25,zoom_delta:1.4,ui_disabled:false,update_on_resize:true,onZoom:null,initCallback:null,onStartDrag:null,onDrag:null,onMouseMove:null,onClick:null,onStartLoad:null,onFinishLoad:null};b.iviewer=function(f,g){var d=this;this.img_object={};this.zoom_object={};this.image_loaded=false;this.dx=0;this.dy=0;this.dragged=false;this.settings=b.extend({},c,g||{});this.current_zoom=this.settings.zoom;if(this.settings.src===null){return}this.container=b(f);this.update_container_info();this.container.css("overflow","hidden");if(this.settings.update_on_resize==true){b(window).resize(function(){d.update_container_info()})}this.img_object.x=0;this.img_object.y=0;this.img_object.object=b("<img>").css({position:"absolute",top:"0px",left:"0px"}).mousedown(function(h){return d.drag_start(h)}).mousemove(function(h){return d.drag(h)}).mouseup(function(h){return d.drag_end(h)}).click(function(h){return d.click(h)}).mouseleave(function(h){return d.drag_end(h)}).mousewheel(function(h,i){var e=(i>0)?1:-1;d.zoom_by(e);return false});this.img_object.object.prependTo(d.container);this.loadImage(this.settings.src);if(!this.settings.ui_disabled){this.createui()}if(this.settings.initCallback){this.settings.initCallback.call(this)}};var a=b.iviewer;a.fn=a.prototype={iviewer:"0.4.2"};a.fn.extend=a.extend=b.extend;a.fn.extend({loadImage:function(e){this.current_zoom=this.settings.zoom;this.image_loaded=false;var d=this;if(this.settings.onStartLoad){this.settings.onStartLoad.call(this)}this.img_object.object.unbind("load").removeAttr("src").removeAttr("width").removeAttr("height").css({top:0,left:0}).load(function(){d.image_loaded=true;d.img_object.display_width=d.img_object.orig_width=this.width;d.img_object.display_height=d.img_object.orig_height=this.height;if(!d.container.hasClass("iviewer_cursor")){d.container.addClass("iviewer_cursor")}if(d.settings.zoom=="fit"){d.fit()}else{d.set_zoom(d.settings.zoom)}if(d.settings.onFinishLoad){d.settings.onFinishLoad.call(d)}}).attr("src",e)},fit:function(){var f=this.img_object.orig_width/this.img_object.orig_height;var d=this.settings.width/this.settings.height;var e=(f>d);var g=0;if(e){g=this.settings.width/this.img_object.orig_width*100
}else{g=this.settings.height/this.img_object.orig_height*100}this.set_zoom(g)},center:function(){this.setCoords(-Math.round((this.img_object.display_height-this.settings.height)/2),-Math.round((this.img_object.display_width-this.settings.width)/2))},moveTo:function(d,i){var f=d-Math.round(this.settings.width/2);var e=i-Math.round(this.settings.height/2);var h=this.img_object.x+f;var g=this.img_object.y+e;this.setCoords(h,g)},setCoords:function(d,e){if(!this.image_loaded){return}if(e>0){e=0}if(d>0){d=0}if(e+this.img_object.display_height<this.settings.height){e=this.settings.height-this.img_object.display_height}if(d+this.img_object.display_width<this.settings.width){d=this.settings.width-this.img_object.display_width}if(this.img_object.display_width<=this.settings.width){d=-(this.img_object.display_width-this.settings.width)/2}if(this.img_object.display_height<=this.settings.height){e=-(this.img_object.display_height-this.settings.height)/2}this.img_object.x=d;this.img_object.y=e;this.img_object.object.css("top",e+"px").css("left",d+"px")},containerToImage:function(d,e){if(d<this.img_object.x||e<this.img_object.y||d>this.img_object.x+this.img_object.display_width||e>this.img_object.y+this.img_object.display_height){return false}return{x:a.descaleValue(d-this.img_object.x,this.current_zoom),y:a.descaleValue(e-this.img_object.y,this.current_zoom)}},imageToContainer:function(d,e){if(d>this.img_object.orig_width||e>this.img_object.orig_height){return false}return{x:this.img_object.x+a.scaleValue(d,this.current_zoom),y:this.img_object.y+a.scaleValue(e,this.current_zoom)}},getMouseCoords:function(d){var f=this.img_object.object.offset();return{x:a.descaleValue(d.pageX-f.left,this.current_zoom),y:a.descaleValue(d.pageY-f.top,this.current_zoom)}},set_zoom:function(j){if(this.settings.onZoom&&this.settings.onZoom.call(this,j)==false){return}if(!this.image_loaded){return}if(j<this.settings.zoom_min){j=this.settings.zoom_min}else{if(j>this.settings.zoom_max){j=this.settings.zoom_max}}if(this.current_zoom=="fit"){var d=Math.round(this.settings.width/2+this.img_object.orig_width/2);var i=Math.round(this.settings.height/2+this.img_object.orig_height/2);this.current_zoom=100}else{var d=-parseInt(this.img_object.object.css("left"),10)+Math.round(this.settings.width/2);var i=-parseInt(this.img_object.object.css("top"),10)+Math.round(this.settings.height/2)}var e=a.scaleValue(this.img_object.orig_width,j);var f=a.scaleValue(this.img_object.orig_height,j);var h=a.scaleValue(a.descaleValue(d,this.current_zoom),j);var g=a.scaleValue(a.descaleValue(i,this.current_zoom),j);h=this.settings.width/2-h;g=this.settings.height/2-g;this.img_object.object.attr("width",e).attr("height",f);this.img_object.display_width=e;this.img_object.display_height=f;this.setCoords(h,g);this.current_zoom=j;this.update_status()},zoom_by:function(g){var f=this.find_closest_zoom_rate(this.current_zoom);var d=f+g;var e=this.settings.zoom_base*Math.pow(this.settings.zoom_delta,d);if(g>0&&e<this.current_zoom){e*=this.settings.zoom_delta}if(g<0&&e>this.current_zoom){e/=this.settings.zoom_delta}this.set_zoom(e)},find_closest_zoom_rate:function(g){if(g==this.settings.zoom_base){return 0}function j(l,k){return l/k}function h(l,k){return l*k}var f=(g>this.settings.zoom_base)?h:j;var i=(g>this.settings.zoom_base)?1:-1;var d=this.settings.zoom_delta;var e=1;while(Math.abs(f(this.settings.zoom_base,Math.pow(d,e))-g)>Math.abs(f(this.settings.zoom_base,Math.pow(d,e+1))-g)){e++}return i*e},update_status:function(){if(!this.settings.ui_disabled){var d=Math.round(100*this.img_object.display_height/this.img_object.orig_height);if(d){this.zoom_object.html(d+"%")}}},update_container_info:function(){this.settings.height=this.container.height();this.settings.width=this.container.width()},drag_start:function(d){if(this.settings.onStartDrag&&this.settings.onStartDrag.call(this,this.getMouseCoords(d))==false){return false}this.dragged=true;this.container.addClass("iviewer_drag_cursor");this.dx=d.pageX-this.img_object.x;this.dy=d.pageY-this.img_object.y;return false},drag:function(g){this.settings.onMouseMove&&this.settings.onMouseMove.call(this,this.getMouseCoords(g));if(this.dragged){this.settings.onDrag&&this.settings.onDrag.call(this,this.getMouseCoords(g));var d=g.pageY-this.dy;var f=g.pageX-this.dx;this.setCoords(f,d);return false}},drag_end:function(d){this.container.removeClass("iviewer_drag_cursor");this.dragged=false},click:function(d){this.settings.onClick&&this.settings.onClick.call(this,this.getMouseCoords(d))},createui:function(){var d=this;b("<div>").addClass("iviewer_zoom_in").addClass("iviewer_common").addClass("iviewer_button").mousedown(function(){d.zoom_by(1);return false}).appendTo(this.container);b("<div>").addClass("iviewer_zoom_out").addClass("iviewer_common").addClass("iviewer_button").mousedown(function(){d.zoom_by(-1);return false}).appendTo(this.container);b("<div>").addClass("iviewer_zoom_zero").addClass("iviewer_common").addClass("iviewer_button").mousedown(function(){d.set_zoom(100);
return false}).appendTo(this.container);b("<div>").addClass("iviewer_zoom_fit").addClass("iviewer_common").addClass("iviewer_button").mousedown(function(){d.fit(this);return false}).appendTo(this.container);this.zoom_object=b("<div>").addClass("iviewer_zoom_status").addClass("iviewer_common").appendTo(this.container);this.update_status()}});a.extend({scaleValue:function(e,d){return e*d/100},descaleValue:function(e,d){return e*100/d}})})(jQuery);